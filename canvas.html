<html>
    <head>

    </head>
    <body>
        <canvas id="canvas" tabindex="1" width="80%" height="900"></canvas>

        <!--<p id="downlog">Down</p>
        <p id="movelog">Move</p>
        <p id="uplog">Up</p>
        <p id="outlog">Out</p>-->

        <script type="text/javascript" language="javascript">
            var canvas = document.getElementById("canvas");
            var context = canvas.getContext("2d");

            // var canvasOffset=$("#canvas").offset();
            // var offsetX=canvasOffset.left;
            // var offsetY=canvasOffset.top;

            var margin = 20;
            var border = 5;
            var width = 160;
            var heigth = 40;

            var rhythm = 1;
            var pulses = 4 * rhythm;
            var measures = 4;
            var frequencies = 5;

            var widthPerCell = border + width;
            var heightPerCell = border + heigth;

            // achar a área dos 
            // var p1x = margin + border;
            // var p1y = margin + border;
            // var p2x = margin + widthPerCell - 1;
            // var p2y = margin + heightPerCell - 1;

            var sequencerWidthPerMeasure = (width * pulses) + (border * (pulses + 1))
            var sequencerHeightPerMeasure = (heigth * frequencies) + (border * (frequencies + 1));

            canvas.width  = margin * 2 + sequencerWidthPerMeasure;
            canvas.height = margin * 2 + sequencerHeightPerMeasure;

            // fazer os measures
            // por a separação de measures, guardar em uma variavel pra calculo de distancia
            // fazer array de posições
            // selecionar
            // selecionados
            // remover a seleção

            // canvas transparente, printar canvas
            // http://stackoverflow.com/questions/19132064/transparency-context-fill-style-in-canvas-html5
            // por na lisa de selecionados
            canvas.addEventListener('click', function(e) { handleClick(e) });

            // verificar se é o SHIFT, se for fazer unbind do click
            // abrir a selação de multiplas celulas
            // http://stackoverflow.com/questions/12886286/addeventlistener-for-keydown-on-canvas
            // verificar se é DEL ou BACKSPACE e remover a seleção
            // verificar se são setas e movimentar a selação
            canvas.addEventListener('keydown', function(e) { handleKeyDown(e) });

            // voltar evento do click   
            canvas.addEventListener('keyup', function(e) { handleKeyUp(e) });

            canvas.addEventListener('mousedown', function(e) { handleMouseDown(e) });

            canvas.addEventListener('mouseup', function(e) { handleMouseUp(e) });

            canvas.addEventListener('mousemove', function(e) { handleMouseMove(e) });

            function draw() {
                context.beginPath();

                context.moveTo(margin, margin);

                // axis x
                for(i = 0; i <= frequencies; i++) {
                    var line = i == 0 ? 0 : border;

                    for (z = 0; z <= border; z++) {
                        context.moveTo(margin, margin + (heigth + line) * i + z);
                        context.lineTo(margin + (width * pulses) + (border * (pulses + 1)), margin + (heigth + line) * i + z);
                    }
                }

                // axis y
                for(i = 0; i <= pulses; i++) {
                    var line = i == 0 ? 0 : border;

                    for (z = 0; z <= border; z++) {
                        context.moveTo(margin + (width + line) * i + z, margin);
                        context.lineTo(margin + (width + line) * i + z, margin + (heigth * frequencies) + (border * (frequencies + 1)));
                    }
                }

                context.stroke();
            }

            function handleClick(e) {
                var i = 1;
            }

            function handleKeyDown(e) {
                var i = 1;
            }

            function handleKeyUp(e) {
                var i = 1;
            }

            function handleMouseDown(e) {
                // mouseX=parseInt(e.clientX-offsetX);
                // mouseY=parseInt(e.clientY-offsetY);
                // $("#downlog").html("Down: "+ mouseX + " / " + mouseY);

                // // Put your mousedown stuff here
            }

            function handleMouseUp(e) {
                // mouseX=parseInt(e.clientX-offsetX);
                // mouseY=parseInt(e.clientY-offsetY);
                // $("#uplog").html("Up: "+ mouseX + " / " + mouseY);

                // // Put your mouseup stuff here
            }

            function handleMouseMove(e) {
                // mouseX=parseInt(e.clientX-offsetX);
                // mouseY=parseInt(e.clientY-offsetY);
                // $("#movelog").html("Move: "+ mouseX + " / " + mouseY);

                // // Put your mousemove stuff here
            }

            draw();
    </script>
    </body>
</html>
